{"version":3,"sources":["../src/State.js"],"names":[],"mappings":"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","file":"State.js","sourcesContent":["import {funcName, dashCase} from './utils';\nimport {app} from './app';\nimport {Controller} from './Controller';\n\nconst DEFAULT_SUFFIX = 'Controller';\n\nexport function State(opts) {\n  if (typeof opts === 'function') {\n    var constructor = opts; opts = null;\n    return register(constructor);\n  }\n\n  opts = (opts || {});\n  var {\n    url,\n    abstract,\n    children=[],\n    scope={},\n    resolve={},\n    template,\n    templateUrl\n  } = opts;\n  return register;\n\n  function register(constructor) {\n    Controller(constructor);\n\n    var name = funcName(constructor);\n    name = name[0].toLowerCase() + name.substr(1, name.length - DEFAULT_SUFFIX.length - 1);\n\n    if (!template && !templateUrl && (template !== false)) {\n      var tmplName = dashCase(name);\n      templateUrl = './components/'+tmplName+'/'+tmplName+'.html';\n    }\n\n    if (template === false) {\n      template = undefined;\n      templateUrl = undefined;\n    }\n\n    if (constructor.onEnter) {\n      State.registerOnEnter(constructor, constructor.onEnter);\n    }\n\n    if (constructor.onExit) {\n      State.registerOnExit(constructor, constructor.onExit);\n    }\n\n    if (constructor.$$resolvers) {\n      for (let name in constructor.$$resolvers) {\n        resolve[name] = constructor.$$resolvers[name];\n      }\n    }\n\n    let state = {\n      name:         name,\n      template:     template,\n      templateUrl:  templateUrl,\n      controller:   funcName(constructor),\n      controllerAs: name,\n\n      children:     children.map(c => Object.create(c.$state, {})),\n      resolve:      resolve,\n      url:          url,\n      abstract:     abstract,\n    };\n\n    if (constructor.$$afterTransition) {\n      State.registerOnEnter(constructor, ['$injector', '$q', '$state', function($injector, $q, $state) {\n        let p = $state.transition || $q.when(null);\n        let $scope = $state.$current.locals['@app'].$scope;\n        let ctrl = $scope[name];\n\n        for (let idx in constructor.$$afterTransition) {\n          let func = constructor.$$afterTransition[idx];\n\n          p = p.then(function() {\n            let val;\n            if (func.$$static) {\n              val = $injector.invoke(func);\n            } else {\n              val = $injector.invoke(func, ctrl);\n            }\n            return $q.when(val);\n          });\n        }\n\n        $state.transition = p;\n      }]);\n    }\n\n    if (constructor.$$onEnter) {\n      state.onEnter = ['$injector', '$q', function($injector, $q) {\n        let p = $q.when(null);\n\n        for (let idx in constructor.$$onEnter) {\n          let func = constructor.$$onEnter[idx];\n\n          p = p.then(function() {\n            let val = $injector.invoke(func);\n            return $q.when(val);\n          });\n        }\n\n        return p;\n      }];\n    }\n\n    if (constructor.$$onExit) {\n      state.onExit = ['$injector', '$q', function($injector, $q) {\n        let p = $q.when(null);\n\n        for (let idx in constructor.$$onExit) {\n          let func = constructor.$$onExit[idx];\n\n          p = p.then(function() {\n            let val = $injector.invoke(func);\n            return $q.when(val);\n          });\n        }\n\n        return p;\n      }];\n    }\n\n    constructor.$state = state;\n  }\n}\n\nState.resolveAs = function resolveAs(name) {\n  return function(target, funcName, desc) {\n    if (!target.$$resolvers) {\n      target.$$resolvers = {};\n    }\n    if (typeof desc.value != 'function') {\n      throw Error(\"expected a function\");\n    }\n    target.$$resolvers[name] = desc.value;\n  };\n};\n\nState.onEnter = function onEnter(target, name, desc) {\n  if (typeof target !== 'function') {\n    throw Error(\"@State.onEnter can only be used with static methods.\");\n  }\n\n  State.registerOnEnter(target, desc.value);\n};\n\nState.registerOnEnter = function registerOnEnter(target, func) {\n  if (!target.$$onEnter) {\n    target.$$onEnter = [];\n  }\n\n  target.$$onEnter.push(func);\n};\n\nState.onExit = function onExit(target, name, desc) {\n  if (typeof target !== 'function') {\n    throw Error(\"@State.onExit can only be used with static methods.\");\n  }\n\n  State.registerOnExit(target, desc.value);\n};\n\nState.registerOnExit = function registerOnExit(target, func) {\n  if (!target.$$onExit) {\n    target.$$onExit = [];\n  }\n\n  target.$$onExit.push(func);\n};\n\nState.afterTransition = function afterTransition(target, name, desc) {\n  let func = desc.value;\n\n  if (typeof target === 'function') {\n    func.$$static = true;\n  } else {\n    func.$$static = false;\n  }\n\n  State.registerAfterTransition(target, func);\n};\n\nState.registerAfterTransition = function registerAfterTransition(target, func) {\n  if (!target.$$afterTransition) {\n    target.$$afterTransition = [];\n  }\n\n  target.$$afterTransition.push(func);\n};\n"]}